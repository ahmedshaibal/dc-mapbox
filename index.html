<!DOCTYPE html>
<html>
<head>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css' rel='stylesheet' />
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.css"/>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />

          <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>

    <style>


    html, body{
      height: 100%;
      width: 100%;
      margin:0px;
      padding: 0px;
    }

    </style>
</head>

<body>
    <div id='map' style='width: 100%; height: 80%;' ></div>

    <div id='bottomChart'>

    </div>


    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="crossfilter.min.js"></script>
    <script src="dc.js">â‰¥</script>
    <script src="leaflet-dc-events.js"></script>
    <script src="mapbox_dc.js"></script>

    <script>
    var mapOptions = {
      container: "map",
      style: 'mapbox://styles/mapbox/streets-v9',
      pointColor: 'red',
      pointRadius: 4,
      pointType: "circle",
      pointIcon: undefined
    }

    myToken = "pk.eyJ1Ijoic2ZhcmxleTIiLCJhIjoiY2lmeWVydWtkNTJpb3RmbTFkdjQ4anhrMSJ9.jRJCOGU1AOHfNXHH7cwU7Q"



    locs = []

    numPoints = 10000

    for (i =0 ; i < numPoints; i++){
      lat= Math.floor(Math.random() * 90);
      lng = Math.floor(Math.random() * -180);
      p = new mapboxgl.LngLat(lng, lat)
      locs.push(p)
    }


      locations = crossfilter(locs)
      allGroup = locations.groupAll()

      locationsDimension = locations.dimension(function(d){return d})
      locationsGrouping = locationsDimension.group().reduceCount()

      latsDimension = locations.dimension(function(d){return d.lat})
      latsGroup = latsDimension.group().reduceCount()
      //
      var mapz = dc_mapbox.pointSymbolMap("#map", myToken, mapOptions)
        .dimension(locationsDimension)
        .group(locationsGrouping)
        // .brushOn(true)
        // .zoom(6)
        // .center([-90, 45])

      // mapz.map().addControl(new mapboxgl.NavigationControl())


      var bottom = dc.barChart("#bottomChart")
        .height($("body").height() * 0.20)
        .width($("body").width())
        .x(d3.scale.linear().domain(d3.extent(locs, function(d){return d.lat})))
        .dimension(latsDimension)
        .group(latsGroup)
        .elasticY(true)


      dc.renderAll()


    </script>
</body>
</html>
